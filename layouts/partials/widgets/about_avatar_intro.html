{{- /* Renders widget: about.avatar_intro
  content.avatarRef: ex) authors/admin
  content.textRef:   ex) authors/admin or home/intro
*/ -}}

{{- $widget := .widget -}}
{{- $params := $widget.Params -}}
{{- $c      := (index $params "content" | default dict) -}}
{{- $lang   := (default "ko" (site.Language.Lang)) -}}

{{- /* 참조 페이지 경로 */ -}}
{{- $avatarRef := (index $c "avatarRef" | default "") -}}
{{- $textRef   := (index $c "textRef"   | default "") -}}

{{- /* 페이지 로드 */ -}}
{{- $avatarPage := "" -}}
{{- if $avatarRef -}}
{{- $p := site.GetPage (printf "/%s/%s" $lang $avatarRef) -}}
{{- if $p -}}{{- $avatarPage = $p -}}{{- end -}}
{{- end -}}
{{- $textPage := "" -}}
{{- if $textRef -}}
{{- $tp := site.GetPage (printf "/%s/%s" $lang $textRef) -}}
{{- if $tp -}}{{- $textPage = $tp -}}{{- end -}}
{{- end -}}

{{- /* 아바타 값: content.avatar > avatarRef.avatar|image > textRef.avatar|image */ -}}
{{- $avatarVal := (index $c "avatar" | default "") -}}
{{- if and (eq $avatarVal "") $avatarPage -}}
{{- $avatarVal = (or ($avatarPage.Params.avatar) ($avatarPage.Params.image)) -}}
{{- end -}}
{{- if and (eq $avatarVal "") $textPage -}}
{{- $avatarVal = (or ($textPage.Params.avatar) ($textPage.Params.image)) -}}
{{- end -}}

{{- /* 아바타 URL: 외부/절대/페이지리소스/assets/media/static/media */ -}}
{{- $avatarURL := "" -}}
{{- if $avatarVal -}}
{{- if or (hasPrefix $avatarVal "http://") (hasPrefix $avatarVal "https://") -}}
 {{- $avatarURL = $avatarVal -}}
{{- else if hasPrefix $avatarVal "/" -}}
 {{- $avatarURL = $avatarVal -}}
{{- else -}}
 {{- if $avatarPage -}}
   {{- with ($avatarPage.Resources.GetMatch $avatarVal) -}}
     {{- $avatarURL = .RelPermalink -}}
   {{- end -}}
 {{- end -}}
 {{- if and (eq $avatarURL "") $textPage -}}
   {{- with ($textPage.Resources.GetMatch $avatarVal) -}}
     {{- $avatarURL = .RelPermalink -}}
   {{- end -}}
 {{- end -}}
 {{- if eq $avatarURL "" -}}
   {{- with (resources.Get (printf "media/%s" $avatarVal)) -}}
     {{- $avatarURL = .RelPermalink -}}
   {{- end -}}
 {{- end -}}
 {{- if eq $avatarURL "" -}}
   {{- $avatarURL = (printf "/media/%s" $avatarVal) -}}
 {{- end -}}
{{- end -}}
{{- end -}}

{{- /* 텍스트: textRef.Content 우선 → description/bio → content.title/text */ -}}
{{- $title := (index $c "title") -}}
{{- $text  := (index $c "text")  -}}
{{- $textHTML := "" -}}
{{- with $textPage -}}
{{- if not $title -}}{{- $title = .Title -}}{{- end -}}
{{- if .Content -}}
 {{- $textHTML = .Content -}}
{{- else -}}
 {{- if not $text -}}
   {{- $text = (or (.Params.description) (.Params.bio)) -}}
 {{- end -}}
{{- end -}}
{{- end -}}

{{- /* 소셜: avatarRef 우선 → content.socials/github/instagram/linkedin/email */ -}}
{{- $socials := slice -}}
{{- with $avatarPage -}}
{{- if .Params.socials -}}
 {{- $socials = .Params.socials -}}
{{- else -}}
 {{- if .Params.github }}{{- $socials = (append $socials (dict "type" "github" "url" .Params.github)) -}}{{ end -}}
 {{- if .Params.instagram }}{{- $socials = (append $socials (dict "type" "instagram" "url" .Params.instagram)) -}}{{ end -}}
 {{- if .Params.linkedin }}{{- $socials = (append $socials (dict "type" "linkedin" "url" .Params.linkedin)) -}}{{ end -}}
 {{- if .Params.email }}{{- $socials = (append $socials (dict "type" "email" "url" (printf "mailto:%s" .Params.email))) -}}{{ end -}}
{{- end -}}
{{- end -}}
{{- if eq (len $socials) 0 -}}
{{- with (index $c "socials") -}}{{- $socials = . -}}{{- end -}}
{{- if eq (len $socials) 0 -}}
 {{- with (index $c "github") }}{{- $socials = (append $socials (dict "type" "github" "url" .)) -}}{{ end -}}
 {{- with (index $c "instagram") }}{{- $socials = (append $socials (dict "type" "instagram" "url" .)) -}}{{ end -}}
 {{- with (index $c "linkedin") }}{{- $socials = (append $socials (dict "type" "linkedin" "url" .)) -}}{{ end -}}
 {{- with (index $c "email") }}{{- $socials = (append $socials (dict "type" "email" "url" (printf "mailto:%s" .))) -}}{{ end -}}
{{- end -}}
{{- end -}}

<section class="py-16">
<!-- 오른쪽으로 약간 이동: 전체 컨테이너에 좌측 패딩 추가 -->
<div class="max-w-5xl mx-auto px-6 md:pl-12">
 <!-- 사진/텍스트 간격 넓힘: gap-12/16 -->
 <div class="grid md:grid-cols-[240px_1fr] gap-12 xl:gap-16 items-start">

   <!-- 왼쪽: 아바타 + 아이콘들 -->
   <div class="flex flex-col items-center md:items-start">
     {{- if $avatarURL -}}
       <img
         src="{{ $avatarURL }}?v=3"
         alt="avatar"
         class="w-48 h-48 object-cover shadow !rounded-full"
         style="border-radius:9999px"
       >
     {{- else -}}
       <div class="w-48 h-48 rounded-2xl bg-gray-300 dark:bg-gray-700"></div>
     {{- end -}}

     {{- if gt (len $socials) 0 -}}
       <div class="mt-4 flex flex-wrap items-center gap-3">
         {{- range $s := $socials -}}
           {{- $t := lower (index $s "type" | default "") -}}
           {{- $u := (index $s "url"  | default "") -}}
           {{- if eq $t "" -}}
             {{- if in $u "github.com" -}}{{- $t = "github" -}}
             {{- else if in $u "instagram.com" -}}{{- $t = "instagram" -}}
             {{- else if in $u "linkedin.com" -}}{{- $t = "linkedin" -}}
             {{- else if hasPrefix $u "mailto:" -}}{{- $t = "email" -}}
             {{- end -}}
           {{- end -}}

           <a href="{{ $u }}" target="_blank" rel="noopener noreferrer"
              aria-label="{{ $t }}" title="{{ $t }}"
              class="inline-flex items-center justify-center w-9 h-9 rounded-full border border-black/20 dark:border-white/20 text-gray-600 dark:text-gray-200 hover:bg-black/5 dark:hover:bg-white/10 transition">
             {{- if eq $t "github" -}}
               <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 .5a12 12 0 0 0-3.79 23.4c.6.11.82-.26.82-.58v-2.24c-3.34.73-4.04-1.61-4.04-1.61-.55-1.4-1.35-1.77-1.35-1.77-1.11-.76.08-.75.08-.75 1.22.09 1.86 1.26 1.86 1.26 1.09 1.86 2.86 1.32 3.56 1.01.11-.8.43-1.32.78-1.63-2.66-.3-5.46-1.33-5.46-5.9 0-1.3.47-2.37 1.24-3.2-.12-.3-.54-1.52.12-3.16 0 0 1.01-.32 3.3 1.22a11.4 11.4 0 0 1 6 0c2.29-1.54 3.29-1.22 3.29-1.22.67 1.64.25 2.86.12 3.16.77.83 1.24 1.9 1.24 3.2 0 4.59-2.8 5.59-5.47 5.89.44.38.83 1.11.83 2.25v3.34c0 .32.21.7.83.58A12 12 0 0 0 12 .5"/></svg>
             {{- else if eq $t "instagram" -}}
               <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm5 3.5A5.5 5.5 0 1 1 6.5 13 5.51 5.51 0 0 1 12 7.5zm6.25-1.25a1.25 1.25 0 1 1-1.25 1.25A1.25 1.25 0 0 1 18.25 5.75z"/></svg>
             {{- else if eq $t "linkedin" -}}
               <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M6.94 7.5H3.56V21h3.38V7.5zM5.25 3a2 2 0 1 0 .02 4 2 2 0 0 0-.02-4zM21 21h-3.38v-6.68c0-1.59-.03-3.62-2.2-3.62-2.2 0-2.54 1.72-2.54 3.51V21H9.5V7.5h3.24v1.84h.05c.45-.86 1.55-1.76 3.18-1.76 3.4 0 4.03 2.24 4.03 5.15V21z"/></svg>
             {{- else if eq $t "email" -}}
               <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm0 2v.01L12 13l8-6.99V6H4zm16 12V9.25l-7.4 5.16a1 1 0 0 1-1.2 0L4 9.25V18h16z"/></svg>
             {{- else -}}
               <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><circle cx="12" cy="12" r="8"/></svg>
             {{- end -}}
           </a>
         {{- end -}}
       </div>
     {{- end -}}
   </div>

   <!-- 오른쪽: 이름, 텍스트 -->
   <div>
     {{- with $title -}}<h2 class="text-3xl font-semibold">{{ . }}</h2>{{- end -}}
     {{- if $text -}}
       <div class="mt-4 prose dark:prose-invert max-w-none">{{ $text | markdownify }}</div>
     {{- else if $textHTML -}}
       <div class="mt-4 prose dark:prose-invert max-w-none">{{ $textHTML | safeHTML }}</div>
     {{- end -}}
   </div>

 </div>
</div>
</section>
