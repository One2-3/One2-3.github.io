{{/* CTA Image + Paragraph (이미지 왼쪽, 텍스트 오른쪽).
  items: [...] 배열/단일필드 모두 지원 + 빈 아이템/빈 섹션 자동 스킵 */}}

{{- $w := .widget -}}

{{/* 1) 데이터 수집 */}}
{{- $items := ($w.Param "items") -}}
{{- if not $items -}}
{{- $btn := ($w.Param "button") | default dict -}}
{{- $single := dict
   "title"    (($w.Param "title")    | default "")
   "text"     (($w.Param "text")     | default "")
   "features" (($w.Param "features") | default (slice))
   "image"    (($w.Param "image")    | default "")
   "button"    (dict
     "text" ((index $btn "text") | default "")
     "url"  ((index $btn "url")  | default "")
   )
 -}}
{{- $items = slice $single -}}
{{- end -}}

{{/* 2) 빈 아이템 제거 */}}
{{- $clean := slice -}}
{{- range $it := $items -}}
{{- $t := (or $it.title "") -}}
{{- $tx := (or $it.text "") -}}
{{- $fs := (or $it.features (slice)) -}}
{{- $img := (or $it.image "") -}}
{{- $btn := (or $it.button dict) -}}
{{- $btnText := (or (index $btn "text") "") -}}
{{- $btnURL  := (or (index $btn "url")  "") -}}
{{- $has :=
   or
     (ne $t "")
     (ne $tx "")
     (gt (len $fs) 0)
     (ne $img "")
     (or (ne $btnText "") (ne $btnURL ""))
-}}
{{- if $has -}}
 {{- $clean = $clean | append $it -}}
{{- end -}}
{{- end -}}

{{/* 3) 전부 비어 있으면 아무것도 렌더하지 않음 */}}
{{- if eq (len $clean) 0 -}}
{{- /* no-op */ -}}
{{- else -}}

{{- $css := ( ($w.Param "design").css_class ) | default "" -}}

<section class="py-12 {{ $css }}">
<div class="container mx-auto px-6 space-y-10">
 {{- range $it := $clean }}
   {{- $title := (or $it.title "") -}}
   {{- $text := (or $it.text  "") -}}
   {{- $features := (or $it.features (slice)) -}}
   {{- $img := (or $it.image "") -}}
   {{- $btn := (or $it.button dict) -}}
   {{- $btnText := (or (index $btn "text") "") -}}
   {{- $btnURL  := (or (index $btn "url")  "") -}}

   {{- $imgURL := $img -}}
   {{- if and $img (not (or (hasPrefix $img "http://") (hasPrefix $img "https://") (hasPrefix $img "/"))) -}}
     {{- $imgURL = (printf "/media/%s" $img) -}}
   {{- end -}}

   <article class="rounded-2xl overflow-hidden border border-gray-200/20 dark:border-gray-700/40 bg-gray-50/5 dark:bg-gray-900/40">
     <div class="grid grid-cols-1 md:grid-cols-12">
       <div class="md:col-span-5">
         {{ if $imgURL }}
           <img src="{{ $imgURL }}" alt="{{ $title }}" class="w-full h-full object-cover md:min-h-[280px]" loading="lazy" />
         {{ else }}
           <div class="w-full h-full md:min-h-[280px] bg-gray-200/30 dark:bg-gray-800/50"></div>
         {{ end }}
       </div>

       <div class="md:col-span-7 p-6 md:p-8">
         {{ with $title }}
           <h3 class="text-2xl md:text-3xl font-semibold mb-3 text-gray-900 dark:text-gray-100">{{ . }}</h3>
         {{ end }}

         {{ with $text }}
           <p class="mb-4 text-gray-800 dark:text-gray-200">{{ . }}</p>
         {{ end }}

         {{ if $features }}
           <ul class="space-y-2 mb-6">
             {{- range $feat := $features }}
               <li class="flex items-start gap-2">
                 <span class="mt-1 text-gray-900 dark:text-gray-100">•</span>
                 <span class="text-gray-900 dark:text-gray-100">{{ $feat | markdownify }}</span>
               </li>
             {{- end }}
           </ul>
         {{ end }}

         {{ if and $btnText $btnURL }}
           <a href="{{ $btnURL }}"
              class="inline-flex items-center px-4 py-2 rounded-xl bg-black text-white hover:bg-black/80 dark:bg-white/10 dark:hover:bg-white/20 transition">
             {{ $btnText }}
           </a>
         {{ end }}
       </div>
     </div>
   </article>
 {{- end }}
</div>
</section>

{{- end -}}
