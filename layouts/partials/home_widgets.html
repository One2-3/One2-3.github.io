{{- $lang := .Lang | default "ko" -}}

{{/* ✔ 섹션명 계산: 홈이면 'home', 아니면 현재 섹션(.Section),
      그리고 비어있으면 최종적으로 'home'로 안전하게 처리 */}}
{{- $sectionName := .Section -}}
{{- if .IsHome -}}
  {{- $sectionName = "home" -}}
{{- end -}}
{{- if not $sectionName -}}
  {{- $sectionName = "home" -}}
{{- end -}}

{{- $sec := site.GetPage (printf "/%s/%s" $lang $sectionName) -}}

<section class="container mx-auto px-6">
  {{- if not $sec -}}
    <div class="text-red-600 py-12">
      content/{{ $lang }}/{{ $sectionName }}/index.md 를 찾을 수 없습니다.
    </div>
  {{- else -}}
    {{- $all := $sec.Resources.Match "**.md" | default (slice) -}}
    {{- $widgets := where (where $all "File.BaseFileName" "!=" "index") "Params.widget" "!=" nil | default (slice) -}}
    {{- if eq (len $widgets) 0 -}}
      <div class="text-red-600 py-12">{{ $sectionName }} 폴더에 위젯(.md) 파일이 없습니다.</div>
    {{- else -}}
      {{- $sorted := sort $widgets "Params.weight" "asc" -}}
      {{- range $p := $sorted -}}
        {{- $w := lower (printf "%v" (index $p.Params "widget")) -}}
        {{- $wfile := replace $w "." "_" -}}  {{/* about.avatar → about_avatar */}}
        {{- $partial := printf "widgets/%s.html" $wfile -}}
        {{- if templates.Exists (printf "partials/%s" $partial) -}}
          {{ partial $partial (dict "page" . "widget" $p) }}
        {{- else -}}
          <div class="py-8 text-amber-600">알 수 없는 위젯: {{ $w }}</div>
        {{- end -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
</section>
